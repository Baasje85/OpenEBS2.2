{% extends "base.html" %}
{% load i18n %}

{% block title %}Berichten{% endblock %}

{% block content %}

  <h1>{% trans "Berichten" %}</h1>

  <h2>{% trans "Actieve berichten" %}
      {% if perms.openebs.add_messages %}
      <a class="btn btn-success pull-right" href="{% url 'msg_add' %}">
        <span class="glyphicon glyphicon-plus-sign"></span> {% trans "Nieuw bericht" %}
      </a>
      {% endif %}
  </h2>
  <table class="table table-bordered table-condensed">
  <tr>
        <th class="col-lg-1">{% trans "Volgnummer"%}</th>
        <th class="col-lg-6">{% trans "Bericht" %}</th>
        <th class="col-lg-1">{% trans "Haltes" %}</th>
        <th class="col-lg-2">{% trans "Tijden" %}</th>
        <th class="col-lg-3">&nbsp;</th>
  </tr>
  {% for msg in active_list %}
      <tr class="{% if msg.is_future %}warning{% endif %}">
        <td>{{ msg.messagecodenumber }}</td>
        <td>{{ msg.messagecontent|default_if_none:"[geen of overschrijf bericht]" }} {% include "openebs/snippet_status.html" with status=msg.status only %}</td>
        <td class="text-center">
            {% if msg.kv15messagestop_set.count > 0 %}
            <a class="halte-count btn btn-link" href="{% url 'msg_view' msg.id %}" data-title="{% trans 'Haltes bij bericht' %}" data-html="true" data-content="{% include 'openebs/snippet_halte-list.html' %}">
                {{ msg.kv15messagestop_set.count }}</a>
            {% else %}
                0
            {% endif %}
        </td>
        <td>{% include "openebs/snippet_message-duration_small.html" with msg=msg only %}</td></td>
        <td>
            <form method="post" action="{% url 'msg_delete' msg.id %}">
                {% csrf_token %}
                <button class="btn btn-danger pull-right">
                    <span class="glyphicon glyphicon-trash"></span>
                </button>
            </form>
            <a href="{% url 'msg_edit' msg.pk %}" class="btn btn-link pull-right">
                <span class="glyphicon glyphicon-edit"></span> {% trans "Bewerk" %}&nbsp;
            </a>&nbsp;
        </td>
    </tr>
  {% empty %}
      <tr><td colspan="5" class="text-center"><em>{% trans "Geen berichten gevonden" %}</em></td></tr>
  {% endfor %}
  </table>
  <p><small>{% trans "Geel = toekomstig bericht" %}</small></p>

  <h2>Verlopen berichten</h2>
  <table class="table table-bordered table-condensed">
  <tr>
      <th class="col-lg-1">{% trans "Volgnummer"%}</th>
      <th class="col-lg-6">{% trans "Bericht" %}</th>
      <th class="col-lg-1">{% trans "Haltes" %}</th>
      <th class="col-lg-5">{% trans "Tijden" %}</th>
  </tr>
  {% for msg in archive_list %}
    <tr class="{% if msg.isdeleted %}danger{% endif %}">
        <td>{{ msg.messagecodenumber }}</td>
        <td>{{ msg.messagecontent|default:"<em>[geen of overschrijf bericht]</em>"|default_if_none:"<em>[geen of overschrijf bericht]</em>" }} {% include "openebs/snippet_status.html" with status=msg.status only %}</td>
        <td class="text-center">
            <a class="halte-count btn btn-link" href="{% url 'msg_view' msg.id %}" data-title="{% trans 'Haltes bij bericht' %}" data-html="true" data-content="{% include 'openebs/snippet_halte-list.html' %}">
                {{ msg.kv15messagestop_set.count }}</a>
        </td>
        <td>
            {% include "openebs/snippet_message-duration.html" with msg=msg only %}
        </td>
    </tr>
  {% empty %}
      <tr><td colspan="5" class="text-center"><em>{% trans "Geen berichten gevonden" %}</em></td></tr>
  {% endfor %}
  </table>
  <p><small>{% trans "Rood = verwijderd bericht" %}</small></p>
{% endblock %}

{% block js_init %}
    $('.halte-count').popover({trigger : 'hover'});
{% endblock %}
